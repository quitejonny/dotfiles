test-java() {
    WATCH_PATH=`pwd`;
    FILE_WATCHES=`mktemp`;
    find $WATCH_PATH -name '*.java' > $FILE_WATCHES

    sigint_handler() {
        exit
    }

    watcher() {
        # CLASSFILES=`find $WATCH_PATH -name '*.class'`;
        # rm $CLASSFILES;

        JAVAFILES=`find $WATCH_PATH -name '*.java'`;

        TESTFILES=`find $WATCH_PATH -name '*Test.java'`;
        TESTCLASSFILES=${TESTFILES//$WATCH_PATH\//};
        TESTCLASSFILES=${TESTCLASSFILES//.java/};
        TESTCLASSFILES=${TESTCLASSFILES//\//.};
        #TESTCLASSFILES=`find $WATCH_PATH -name '*Test.java' -type f -execdir basename {} .java ';'`;
        JAVAC=javac;
        JAVA=java;
        CLASSPATH=$WATCH_PATH:$WATCH_PATH/test:/usr/share/java/*;
        echo "|$TESTCLASSFILES|";
        $JAVAC -cp $CLASSPATH $JAVAFILES \
        && $JAVA -cp $CLASSPATH org.junit.runner.JUnitCore $TESTCLASSFILES;
    }

    trap sigint_handler SIGINT

    while true; do
        watcher
        inotifywait -e CLOSE_WRITE --fromfile $FILE_WATCHES
    done
}
